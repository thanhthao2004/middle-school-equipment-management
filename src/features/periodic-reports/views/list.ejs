<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Danh sách báo cáo định kỳ</title>

    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/stylesheets/style.css" rel="stylesheet">

    <style>
        .page-header {
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
<%
    const userObj = user || { role: 'ql_thiet_bi' };
%>

<!-- HEADER -->
<%- include('../../../views/partials/header', {
    currentPage: 'periodic-reports',
    user: userObj
}) %>

<div class="container-fluid p-0">
    <div class="row g-0">

        <!-- SIDEBAR -->
        <%- include('../../../views/partials/qltb-sidebar', {
            currentPage: 'periodic-reports',
            user: userObj
        }) %>

        <!-- CONTENT -->
        <div class="col-md-9 col-lg-10">
            <div class="container py-4">

                <div class="page-header">
                    <h1>Quản lý báo cáo định kỳ</h1>
                </div>

                <!-- FILTER -->
                <div class="d-flex justify-content-between mb-3">
                    <div>
                        <select id="periodFilter" class="form-select w-25" style="display: inline-block; width: 250px !important;">
                            <option value="">Tất cả kỳ báo cáo</option>
                            <% (periods || []).forEach(p => { %>
                                <option value="<%= p %>"><%= p %></option>
                            <% }) %>
                        </select>
                    </div>

                    <a href="/manager/periodic-reports/create"
                       class="btn btn-primary">
                        + Lập báo cáo mới
                    </a>
                </div>

                <!-- LIST -->
                <% if (reports && reports.length > 0) { %>
                    <table class="table table-bordered align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Mã</th>
                                <th>Kỳ</th>
                                <th>Ngày lập</th>
                                <!-- <th>Trạng thái</th> -->
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="reportsList">
                            <% reports.forEach(r => { %>
                                <tr data-period="<%= r.period %>">
                                    <!-- <td><%= r.code %></td>
                                    <td><%= r.period %></td>
                                    <td><%= r.date %></td>
                                    <td>
                                        <% if (r.status === 'pending') { %>
                                            <span class="badge bg-warning">Chờ duyệt</span>
                                        <% } else if (r.status === 'completed') { %>
                                            <span class="badge bg-success">Đã duyệt</span>
                                        <% } else { %>
                                            <span class="badge bg-danger">Từ chối</span>
                                        <% } %>
                                    </td>
                                    <td> -->
                                        <a href="/manager/periodic-reports/<%= r.id %>"
                                           class="btn btn-sm btn-outline-primary">
                                            Xem
                                        </a>
                                    </td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                <% } else { %>
                    <div class="alert alert-info">
                        Chưa có báo cáo định kỳ nào.
                    </div>
                <% } %>

            </div>
        </div>

    </div>
</div>

<%- include('../../../views/partials/footer') %>

<script>
    document.getElementById('periodFilter').addEventListener('change', function() {
        const selectedPeriod = this.value;
        const rows = document.querySelectorAll('#reportsList tr');
        
        rows.forEach(row => {
            const period = row.getAttribute('data-period');
            if (!selectedPeriod || period === selectedPeriod) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });
</script>

</body>
</html>