<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng ký mượn thiết bị</title>
    
    <!-- Bootstrap 5.3.0 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome 6.4.0 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Custom Styles -->
    <link href="/public/stylesheets/style.css" rel="stylesheet">
    <link href="/public/stylesheets/borrow.css" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <%- include('../../../views/partials/header') %>
    <div class="container-fluid p-0">
        <div class="row g-0">
            <!-- Sidebar -->
            <%- include('../../../views/partials/borrow-sidebar') %>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 main-content">
                <div class="container py-4">

                    <!-- Filters and Search -->
<div class="card mb-4">
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-2">
                <label class="form-label fw-bold text-muted small">DANH MỤC THIẾT BỊ</label>
                            <select class="form-select" id="categoryFilter">
                    <option value="">Tất cả danh mục</option>
                                <option value="chemistry">Hóa học</option>
                                <option value="it">Tin học</option>
                                <option value="literature">Ngữ văn</option>
                                <option value="physics">Vật lý</option>
                            </select>
                        </div>
            <div class="col-md-2">
                <label class="form-label fw-bold text-muted small">LỚP HỌC</label>
                            <select class="form-select" id="classFilter">
                    <option value="">Tất cả lớp</option>
                                <option value="6">Lớp 6</option>
                                <option value="7">Lớp 7</option>
                                <option value="8">Lớp 8</option>
                                <option value="9">Lớp 9</option>
                            </select>
                        </div>
            <div class="col-md-2">
                <label class="form-label fw-bold text-muted small">NGÀY MƯỢN TỪ</label>
                <input type="date" class="form-control" id="borrowDateFrom" 
                       value="" min="">
            </div>
            <div class="col-md-2">
                <label class="form-label fw-bold text-muted small">NGÀY MƯỢN ĐẾN</label>
                <input type="date" class="form-control" id="borrowDateTo" 
                       value="" min="">
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold text-muted small">TÌM KIẾM THIẾT BỊ</label>
                            <div class="search-container">
                    <input type="text" class="form-control" placeholder="Nhập tên thiết bị, mã thiết bị..." id="searchInput">
                                <i class="fas fa-search search-icon"></i>
                            </div>
            </div>
            <div class="col-md-1 d-flex align-items-end">
                <button class="btn btn-outline-secondary w-100" onclick="resetFilters()" title="Reset bộ lọc">
                    <i class="fas fa-undo"></i>
                </button>
            </div>
        </div>
        
        <!-- Advanced Filters Row -->
        <div class="row g-3 mt-2" id="advancedFilters" style="display: none;">
            <div class="col-md-2">
                <label class="form-label fw-bold text-muted small">TRẠNG THÁI</label>
                <select class="form-select" id="statusFilter">
                    <option value="">Tất cả trạng thái</option>
                    <option value="available">Có sẵn</option>
                    <option value="borrowed">Đã mượn</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label fw-bold text-muted small">TÌNH TRẠNG</label>
                <select class="form-select" id="conditionFilter">
                    <option value="">Tất cả tình trạng</option>
                    <option value="good">Tốt</option>
                    <option value="damaged">Hỏng</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label fw-bold text-muted small">VỊ TRÍ LƯU TRỮ</label>
                <select class="form-select" id="locationFilter">
                    <option value="">Tất cả vị trí</option>
                    <option value="Phòng thiết bị 2">Phòng thiết bị 2</option>
                    <option value="Kho Hóa học">Kho Hóa học</option>
                    <option value="Phòng IT">Phòng IT</option>
                    <option value="Phòng 101">Phòng 101</option>
                    <option value="Phòng thiết bị 3">Phòng thiết bị 3</option>
                    <option value="Thư viện">Thư viện</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label fw-bold text-muted small">NGUỒN GỐC</label>
                <select class="form-select" id="originFilter">
                    <option value="">Tất cả nguồn gốc</option>
                    <option value="CC">CC</option>
                    <option value="NCC">NCC</option>
                    <option value="GV Thanh Th">GV Thanh Th</option>
                    <option value="Bộ giáo dục">Bộ giáo dục</option>
                </select>
            </div>
            <div class="col-md-4 d-flex align-items-end">
                <div class="d-flex gap-2 w-100">
                    <button class="btn btn-outline-info btn-sm" onclick="applyFilters()">
                        <i class="fas fa-filter me-1"></i>Áp dụng
                    </button>
                    <button class="btn btn-outline-warning btn-sm" onclick="clearAdvancedFilters()">
                        <i class="fas fa-times me-1"></i>Xóa bộ lọc
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Toggle Advanced Filters -->
        <div class="text-center mt-3">
            <button class="btn btn-link text-muted" onclick="toggleAdvancedFilters()" id="toggleAdvancedBtn">
                <i class="fas fa-chevron-down me-1"></i>
                Bộ lọc nâng cao
            </button>
        </div>
    </div>
</div>

<!-- Selection Counter -->
<div class="d-flex justify-content-between align-items-center mb-3">
    <div class="d-flex align-items-center">
        <h5 class="mb-0 me-3">Danh sách thiết bị</h5>
        <span class="selection-counter" id="selectionCounter" style="display: none;">
            <i class="fas fa-check-circle me-1"></i>
            <span id="selectedCount">0</span> thiết bị đã chọn
        </span>
    </div>
    <div class="d-flex gap-2">
        <button class="btn btn-outline-primary btn-sm" onclick="selectAllAvailable()">
            <i class="fas fa-check-double me-1"></i>Chọn tất cả có sẵn
        </button>
        <button class="btn btn-outline-secondary btn-sm" onclick="cancelSelection()">
            <i class="fas fa-times me-1"></i>Bỏ chọn tất cả
        </button>
                        </div>
                    </div>

                    <!-- Equipment Table -->
                    <div class="card mt-2">
                        <div class="card-body p-0">
                            <div class="table-responsive">
            <table class="table table-hover equipment-table mb-0" id="equipmentTable">
                                    <thead>
                                        <tr>
                        <th width="5%">Mã TB</th>
                        <th width="20%">Tên Thiết Bị</th>
                        <th width="8%">Danh mục</th>
                        <th width="6%">Đơn vị</th>
                        <th width="8%">Lớp</th>
                        <th width="6%">SL Tồn</th>
                        <th width="8%">Trạng Thái</th>
                        <th width="8%">Tình trạng</th>
                        <th width="12%">Vị Trí Lưu Trữ</th>
                        <th width="8%">Nguồn Gốc</th>
                        <th width="6%">Chi tiết</th>
                        <th width="5%">Chọn</th>
                                        </tr>
                                    </thead>
                <tbody id="equipmentTableBody">
                    <tr data-category="chemistry" data-class="8,9" data-status="available" data-condition="good">
                        <td><span class="fw-bold text-primary">101</span></td>
                        <td>
                            <div class="fw-bold">Bộ dụng cụ thí nghiệm H2SO4</div>
                            <small class="text-muted">Thiết bị hóa học chuyên dụng</small>
                        </td>
                        <td><span class="badge bg-info">Hóa học</span></td>
                                            <td>cái</td>
                                            <td>8, 9</td>
                        <td><span class="fw-bold text-success">3</span></td>
                                            <td><span class="status-available">Có sẵn</span></td>
                        <td><span class="condition-good">Tốt</span></td>
                                            <td>Phòng thiết bị 2</td>
                                            <td>CC</td>
                                            <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="viewDetails(101)" title="Xem chi tiết">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </td>
                                            <td>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input equipment-checkbox" 
                                       data-device-id="101" data-max-quantity="3" checked>
                            </div>
                                            </td>
                                        </tr>
                    <!-- More rows... -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex justify-content-end mt-4 gap-3">
                        <button class="btn btn-cancel text-white" onclick="cancelSelection()">
        <i class="fas fa-times me-2"></i>Hủy chọn
                        </button>
                        <button class="btn btn-register text-white" onclick="openBorrowForm()">
        <i class="fas fa-clipboard-list me-2"></i>Đăng ký
                        </button>
    </div>

    <!-- Device Details Modal -->
    <div class="modal fade" id="deviceDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Chi tiết thiết bị</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="text-center mb-3">
                                <div class="bg-light border rounded p-5">
                                    <i class="fas fa-image fa-3x text-muted"></i>
                                    <p class="mt-2 text-muted">Hình ảnh thiết bị</p>
                                </div>
                            </div>
                            <div class="text-center">
                                <h5 id="deviceName">Bộ dụng cụ thí nghiệm H2SO4</h5>
                                <button class="btn btn-primary mt-2" onclick="selectDevice()">
                                    Chọn mượn
                                </button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>Thông tin thiết bị:</h6>
                            <table class="table table-sm">
                                <tr>
                                    <td><strong>Mã thiết bị:</strong></td>
                                    <td id="deviceId">101</td>
                                </tr>
                                <tr>
                                    <td><strong>Danh mục:</strong></td>
                                    <td id="deviceCategory">Hóa học</td>
                                </tr>
                                <tr>
                                    <td><strong>Đơn vị:</strong></td>
                                    <td id="deviceUnit">cái</td>
                                </tr>
                                <tr>
                                    <td><strong>Lớp sử dụng:</strong></td>
                                    <td id="deviceClass">8, 9</td>
                                </tr>
                                <tr>
                                    <td><strong>Số lượng tồn:</strong></td>
                                    <td id="deviceQuantity">3</td>
                                </tr>
                                <tr>
                                    <td><strong>Trạng thái:</strong></td>
                                    <td id="deviceStatus">Có sẵn</td>
                                </tr>
                                <tr>
                                    <td><strong>Tình trạng:</strong></td>
                                    <td id="deviceCondition">Tốt</td>
                                </tr>
                                <tr>
                                    <td><strong>Vị trí lưu trữ:</strong></td>
                                    <td id="deviceLocation">Phòng thiết bị 201</td>
                                </tr>
                                <tr>
                                    <td><strong>Nguồn gốc:</strong></td>
                                    <td id="deviceOrigin">NCC</td>
                                </tr>
                            </table>
                            
                            <h6 class="mt-3">Nhà cung cấp:</h6>
                            <p id="deviceSupplier">Công ty TNHH Hóa Chất Việt</p>
                            
                            <h6>Hướng dẫn sử dụng:</h6>
                            <ul class="small">
                                <li>Đeo găng tay và kính bảo hộ khi sử dụng.</li>
                                <li>Không để gần nguồn nhiệt hoặc nơi có ánh nắng trực tiếp.</li>
                                <li>Pha loãng dung dịch theo tỷ lệ an toàn trong phòng thí nghiệm.</li>
                                <li>Sau khi dùng, rửa sạch và cất lại đúng vị trí.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Borrow Form Modal -->
    <div class="modal fade" id="borrowFormModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Phiếu mượn</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th>ST</th>
                                    <th>Tên Thiết Bị</th>
                                    <th>Danh mục</th>
                                    <th>Đơn vị</th>
                                    <th>Số Lượng</th>
                                    <th>Vị Trí Lưu Trữ</th>
                                    <th>Nguồn Gốc</th>
                                    <th>Ngày mượn</th>
                                    <th>Ngày trả</th>
                                    <th>Số lượng mượn</th>
                                    <th>Dạy tiết</th>
                                    <th>Nội dung</th>
                                </tr>
                            </thead>
                            <tbody id="borrowFormTable">
                                <!-- Dynamic content will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-primary" onclick="submitBorrowForm()">Xác nhận</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Close main content wrappers to align footer like pending-approvals -->
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <%- include('../../../views/partials/footer') %>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Borrow Feature JavaScript -->
    <script src="/public/javascripts/borrow.js"></script>
</body>
</html>
