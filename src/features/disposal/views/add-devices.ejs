<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chọn thiết bị</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/public/stylesheets/disposal.css">
    <link rel="stylesheet" href="/public/stylesheets/style.css">
</head>

<body>

    <!-- Sidebar -->
    <%- include('../../../views/partials/qltb-sidebar') %>

    <div class="main">

        <!-- HEADER -->
        <div class="main-header">
            <div style="display:flex; align-items:center;">
                <button class="btn-menu" id="toggleSidebar"><i class="fas fa-bars"></i></button>
                <h2>CHỌN THIẾT BỊ</h2>
            </div>
            <div class="user"><i class="fas fa-user"></i> QLTB</div>
        </div>

        <!-- INFO SECTION -->
        <div class="disposal-info mb-3">
            <div class="info-box info-code">
                <label>Mã biên bản</label>
                <span class="value"><%= code || '' %></span>
            </div>
            <div class="info-box info-year">
                <label>Năm học</label>
                <span class="value"><%= year || '' %></span>
            </div>
            <div class="info-box info-date">
                <label>Ngày lập</label>
                <span class="value"><%= created_at || '' %></span>
            </div>

            <!-- Search Box -->
            <div class="search-box" style="margin-bottom: 20px; max-width: 300px; margin-left:auto;">
                <input type="text" placeholder="Tìm thiết bị...">
                <button type="button" class="search-btn"><i class="fas fa-search"></i> Tìm kiếm</button>
            </div>
        </div>

        <!-- TABLE THIẾT BỊ -->
        <div class="table-responsive">
            <table class="disposal-table table table-bordered">
                <thead>
                    <tr>
                        <th>Chọn</th>
                        <th>Tên thiết bị</th>
                        <th>Loại thiết bị</th>
                        <th>Bộ môn quản lý</th>
                        <th>Ngày phát hiện hỏng</th>
                        <th>Mức độ hỏng</th>
                        <th>Lý do hỏng</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (devices && devices.length > 0) { %>
                        <% devices.forEach(d => { %>
                            <tr>
                                <td><input type="checkbox" name="selectedDevices" value="<%= d.id %>"></td>
                                <td><%= d.name %></td>
                                <td><%= d.type %></td>
                                <td><%= d.department %></td>
                                <td><%= d.broken_date || d.detected_at || '' %></td>
                                <td>
                                    <% if(d.level === 'Hỏng nặng') { %>
                                        <div class="level-badge level-severe">Hỏng nặng</div>
                                    <% } else if(d.level === 'Hỏng nhẹ') { %>
                                        <div class="level-badge level-low">Hỏng nhẹ</div>
                                    <% } else { %>
                                        <div class="level-badge"><%= d.level %></div>
                                    <% } %>
                                </td>
                                <td><%= d.reason || '' %></td>
                            </tr>
                        <% }) %>
                    <% } else { %>
                        <tr>
                            <td colspan="7" class="text-center text-muted">Chưa có thiết bị nào</td>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        </div>

        <!-- Nút thêm vào báo cáo / quay lại -->
        <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:20px;">
            <a href="/disposal/add?code=<%= code %>&year=<%= year %>&created_at=<%= created_at %>"
                class="btn disposal-btn">
                <i class="fas fa-check"></i> Chọn
            </a>
            <a href="/disposal/add?code=<%= code %>&year=<%= year %>&created_at=<%= created_at %>"
                class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Quay lại
            </a>
        </div>

    </div>

    <script src="/public/javascripts/disposal.js"></script>
</body>

</html>
