<!DOCTYPE html>
<html lang="vi">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>
		<%= title || 'Đổi mật khẩu' %>
	</title>
	<link href="/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
	<link href="/stylesheets/style.css" rel="stylesheet">
	<style>
		/* Small page-specific tweaks following COLOR_GUIDELINES */
		.change-card {
			border-radius: 12px;
			box-shadow: 0 8px 24px rgba(2, 6, 23, 0.06);
		}

		.change-card .card-header {
			background: var(--white);
			border-bottom: none;
		}

		.btn-primary-custom {
			background-color: var(--button-primary);
			border-color: var(--button-primary);
			color: var(--white);
		}

		.btn-cancel-custom {
			background-color: var(--button-danger);
			border-color: var(--button-danger);
			color: var(--white);
		}

		.form-label {
			color: var(--dark-gray);
		}

		.password-field {
			position: relative;
		}

		.password-field .form-control {
			padding-right: 44px;
		}

		.password-field .toggle-visibility {
			position: absolute;
			top: 50%;
			right: 12px;
			transform: translateY(-50%);
			border: none;
			background: transparent;
			color: #6c757d;
			padding: 4px;
		}

		.password-field .toggle-visibility:focus {
			box-shadow: none;
		}
	</style>
</head>

<body class="bg-light gradient-bg">
	<div class="container py-5">
		<div class="row justify-content-center">
			<div class="col-md-7 col-lg-5">
				<div class="card change-card border-0">
					<div class="card-header text-center py-3">
						<div class="d-flex align-items-center justify-content-center gap-2 mb-1">
							<i class="fa-solid fa-lock text-primary"></i>
							<h4 class="m-0" style="color:var(--primary-blue);">Đổi mật khẩu</h4>
						</div>
						<small class="text-muted">Vui lòng nhập mật khẩu hiện tại và mật khẩu mới</small>
					</div>
					<div class="card-body">
						<% if (typeof errors !=='undefined' && errors && errors.length) { %>
							<div class="alert alert-danger" role="alert">
								<ul class="mb-0">
									<% errors.forEach(function(err){ %>
										<li>
											<%= err %>
										</li>
										<% }) %>
								</ul>
							</div>
							<% } else if (typeof error !=='undefined' && error) { %>
								<div class="alert alert-danger" role="alert">
									<%= error %>
								</div>
								<% } %>

									<% if (typeof success !=='undefined' && success) { %>
										<div class="alert alert-success" role="alert">
											<%= success %>
										</div>
										<% } %>

											<form method="POST" action="/auth/password/change" class="mt-2">
												<div class="mb-3">
													<label for="currentPassword" class="form-label">Mật khẩu hiện
														tại</label>
													<div class="password-field">
														<input type="password" class="form-control" id="currentPassword"
															name="currentPassword" placeholder="Nhập mật khẩu hiện tại"
															required>
														<button class="toggle-visibility" type="button"
															data-target="currentPassword"
															aria-label="Hiển thị/Ẩn mật khẩu">
															<i class="fa-solid fa-eye"></i>
														</button>
													</div>
												</div>

												<div class="mb-3">
													<label for="newPassword" class="form-label">Mật khẩu mới</label>
													<div class="password-field">
														<input type="password" class="form-control" id="newPassword"
															name="newPassword" placeholder="Tối thiểu 8 ký tự" required>
														<button class="toggle-visibility" type="button"
															data-target="newPassword" aria-label="Hiển thị/Ẩn mật khẩu">
															<i class="fa-solid fa-eye"></i>
														</button>
													</div>
												</div>

												<div class="mb-3">
													<label for="confirmPassword" class="form-label">Xác nhận mật khẩu
														mới</label>
													<div class="password-field">
														<input type="password" class="form-control" id="confirmPassword"
															name="confirmPassword" placeholder="Nhập lại mật khẩu mới"
															required>
														<button class="toggle-visibility" type="button"
															data-target="confirmPassword"
															aria-label="Hiển thị/Ẩn mật khẩu">
															<i class="fa-solid fa-eye"></i>
														</button>
													</div>
												</div>

												<div class="d-flex gap-2">
													<button type="submit" class="btn btn-primary-custom w-100">Cập nhật
														mật khẩu</button>
													<a href="/profile" class="btn btn-cancel-custom w-100">Hủy</a>
												</div>
											</form>
					</div>
					<div class="card-footer text-center">
						<small class="text-muted d-block">Mật khẩu nên bao gồm chữ hoa, chữ thường, số và ký tự đặc
							biệt.</small>
						<small class="text-muted">Không chia sẻ mật khẩu cho người khác.</small>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="/js/bootstrap.bundle.min.js"></script>
	<script>
		// Toggle password visibility for all password fields
		(function () {
			document.querySelectorAll('.toggle-visibility').forEach(function (btn) {
				btn.addEventListener('click', function () {
					var targetId = btn.getAttribute('data-target');
					var input = document.getElementById(targetId);
					if (!input) return;
					var isHidden = input.type === 'password';
					input.type = isHidden ? 'text' : 'password';
					var icon = btn.querySelector('i');
					if (icon) {
						icon.classList.toggle('fa-eye', isHidden === false);
						icon.classList.toggle('fa-eye-slash', isHidden === true);
					}
				});
			});
		})();
	</script>
</body>

</html>