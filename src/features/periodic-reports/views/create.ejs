<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/stylesheets/style.css" rel="stylesheet">
    <style>
        .form-label { font-weight:600 }
        .app-shell { display: flex; }
        .main-content { margin-left: 230px; padding: 20px; width: 100%; }
        .page-header { border-bottom: 1px solid #dee2e6; margin-bottom: 20px; padding-bottom: 10px; }
    </style>
</head>
<body>
    <% const userObj = (typeof user !== 'undefined' && user) ? user : { role: 'ql_thiet_bi' }; %>
    <!-- Header -->
    <%- include('../../../views/partials/header', { currentPage: 'periodic-reports', user: userObj }) %>

    <div class="container-fluid p-0">
      <div class="row g-0">
        <%- include('../../../views/partials/qltb-sidebar', { currentPage: 'periodic-reports', user: userObj }) %>

        <div class="col-md-9 col-lg-10 main-content">
          <div class="container py-4">
            <div class="app-shell">

        <main class="main-content">
            <div class="page-header">
                <h1>Lập báo cáo định kỳ</h1>
                <div style="font-size:14px; margin-top:6px;">Tạo báo cáo tình trạng thiết bị định kỳ</div>
            </div>

            <form action="/manager/periodic-reports" method="post" enctype="multipart/form-data">
                <div class="card p-4 mx-auto" style="max-width: 700px;">
                    <h5 class="card-title mb-4">Thông tin chung</h5>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label">Mã báo cáo</label>
                            <input id="report-code-display" class="form-control" readonly value="BC00X" />
                            <input type="hidden" id="report-code" name="code" value="" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Ngày lập</label>
                            <input id="report-date-display" class="form-control" readonly value="" />
                            <input type="hidden" id="report-date" name="date" value="" />
                        </div>
                        <div class="col-12">
                            <label for="period" class="form-label">Kỳ báo cáo</label>
                            <input type="text" class="form-control" id="period" name="period" placeholder="Ví dụ: Học kỳ II 2024-2025" required>
                        </div>
                        <div class="col-12">
                            <label for="reportFile" class="form-label">Tải lên File Báo cáo (PDF, DOCX)</label>
                            <input class="form-control" type="file" id="reportFile" name="reportFile" accept=".pdf,.doc,.docx" required>
                            <div class="form-text">Tối đa 5MB.</div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-end gap-3">
                        <a href="/manager/periodic-reports" class="btn btn-secondary">Hủy</a>
                        <button type="submit" class="btn btn-primary">Lưu và Gửi</button>
                    </div>
                </div>
            </form>

        </main>
    </div>

    <script src="/js/bootstrap.bundle.min.js"></script>
    <script>
        (function(){
            // Auto-generate report code and date on page load
            const codeInput = document.getElementById('report-code');
            const codeDisplay = document.getElementById('report-code-display');
            const dateInput = document.getElementById('report-date');
            const dateDisplay = document.getElementById('report-date-display');
            
            const today = new Date();
            const iso = today.toISOString().slice(0,10); // YYYY-MM-DD
            
            if(!codeInput.value){
                // Mock code generation (In real app, this should be done on the server)
                const rand = Math.floor(Math.random() * 999) + 1;
                const num = String(rand).padStart(3, '0');
                const genCode = `BC${num}`;
                codeInput.value = genCode;
                if(codeDisplay) codeDisplay.value = genCode;
            }

            if(!dateInput.value){
                dateInput.value = iso;
                // Format display date to DD/MM/YYYY
                const parts = iso.split('-');
                if(dateDisplay) dateDisplay.value = `${parts[2]}/${parts[1]}/${parts[0]}`;
            }
        })();
    </script>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%- include('../../../views/partials/footer') %>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>