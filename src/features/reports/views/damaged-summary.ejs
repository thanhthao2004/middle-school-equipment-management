<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= title %>
    </title>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/stylesheets/style.css" rel="stylesheet">
    <link href="/stylesheets/damaged-summary.css" rel="stylesheet">
    <link href="/stylesheets/purchasing-plans.css" rel="stylesheet">
    <link href="/stylesheets/tranining-plans.css" rel="stylesheet">


</head>

<body>
    <% const userObj=(typeof user !=='undefined' && user) ? user : { role: 'to_truong' }; %>
        <!-- Header -->
        <%- include('../../../views/partials/header', { currentPage: 'reports' , user: userObj }) %>

            <div class="container-fluid p-0">
                <div class="row g-0">
                    <%- include('../../../views/partials/teacher-sidebar', { currentPage: 'reports' , user: userObj })
                        %>

                        <div class="col-md-9 col-lg-10 main-content">
                            <div class="container py-4">
                                <div class="app-shell">
                                    <main class="main-content">
                                        <div class="page-header">
                                            <h1>Xem báo cáo thống kê thiết bị hỏng</h1>
                                        </div>

                                        <div class="controls">
                                            <!-- Reserved for future filters -->
                                        </div>

                                        <div class="card card-table mt-3">
                                            <div class="card-body">
                                                <% 
                                                const _items = items || rows || damagedItems || []; 
                                                if (_items && _items.length) { 
                                                %>
                                                    <div class="table-responsive">
                                                        <table class="table align-middle">
                                                            <thead>
                                                                <tr>
                                                                    <th>Tên Danh Mục TB</th>
                                                                    <th>Mã TB</th>
                                                                    <th>Tên TB</th>
                                                                    <th class="text-center">Số lượng</th>
                                                                    <th>ĐVT</th>
                                                                    <th class="text-end">Mức độ hỏng</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <% _items.forEach(function(it, idx) { %>
                                                                    <tr>
                                                                        <td>
                                                                            <%= it.categoryName || it.catName ||
                                                                                it.category || '-' %>
                                                                        </td>
                                                                        <td>
                                                                            <%= it.code || it.itemCode || '-' %>
                                                                        </td>
                                                                        <td>
                                                                            <%= it.name || it.itemName || '-' %>
                                                                        </td>
                                                                        <td class="text-center">
                                                                            <%= it.quantity !=null ? it.quantity : '-'
                                                                                %>
                                                                        </td>
                                                                        <td>
                                                                            <%= it.unit || it.uom || '-' %>
                                                                        </td>
                                                                        <td class="text-end">
                                                                            <% 
                                                                            let badgeClass = 'status-unknown';
                                                                            let severityText = '-';
                                                                            if(it.severity === 'nang' || it.severity === 'high') {
                                                                                badgeClass = 'status-high';
                                                                                severityText = 'Nặng';
                                                                            } else if(it.severity === 'kha' || it.severity === 'medium') {
                                                                                badgeClass = 'status-medium';
                                                                                severityText = 'Khá';
                                                                            } else if(it.severity === 'trungbinh' || it.severity === 'normal') {
                                                                                badgeClass = 'status-normal';
                                                                                severityText = 'Trung bình';
                                                                            }
                                                                            %>
                                                                            <span class="status-badge <%= badgeClass %>">
                                                                                <%= severityText %>
                                                                            </span>
                                                                        </td>
                                                                    </tr>
                                                                    <% }) %>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <% } else { %>
                                                        <div class="alert alert-info">Không có dữ liệu báo cáo.</div>
                                                        <% } %>
                                            </div>
                                        </div>

                                        <div class="d-flex justify-content-end mt-4">
                                            <a href="/teacher/reports/damaged-summary/export"
                                                class="btn btn-primary btn-lg export-btn">
                                                <i class="fas fa-file-export me-2"></i> Xuất báo cáo
                                            </a>
                                        </div>
                                    </main>
                                </div>
                            </div>
                        </div>
                </div>
            </div>

            <%- include('../../../views/partials/footer') %>

                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>